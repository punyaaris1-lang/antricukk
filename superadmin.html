<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUPER ADMIN - GOD MODE</title>
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@300;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* === STYLE ULTIMATE (TEMA EMAS) === */
        :root { 
            --bg: #050505; --panel: #111; --border: #333; 
            --gold: #FFD700; --red: #FF003C; --blue: #00F0FF; 
            --term-bg: #000; --term-text: #0f0; 
        }
        body { background: #0a0a0a; color: #fff; font-family: 'JetBrains Mono', monospace; padding: 10px; font-size: 11px; margin: 0; }
        .box { border: 1px solid #333; padding: 15px; margin-bottom: 15px; background: #000; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        h3 { margin: 0 0 15px 0; color: var(--gold); border-bottom: 1px solid #333; padding-bottom: 5px; font-family: 'Teko', sans-serif; font-size: 20px; letter-spacing: 1px; }
        button { cursor: pointer; padding: 8px 12px; margin: 0; font-weight: bold; font-family: 'Teko'; font-size: 14px; letter-spacing: 0.5px; border-radius: 4px; transition: 0.2s; border: none; text-transform: uppercase; }
        button:hover { filter: brightness(1.2); transform: translateY(-1px); }
        .btn-gold { background: linear-gradient(45deg, #DAA520, #FFD700); color: #000; border: 1px solid #FFD700; }
        .btn-red { background: linear-gradient(45deg, #900, #d00); color: #fff; border: 1px solid #f00; }
        .btn-blue { background: linear-gradient(45deg, #005, #009); color: #fff; border: 1px solid #00f; }
        .btn-mini { padding: 4px 8px; font-size: 12px; margin: 2px; }
        input, select { background: #1a1a1a; color: #fff; border: 1px solid #444; padding: 8px; border-radius: 4px; font-family: 'JetBrains Mono'; width: 100%; box-sizing: border-box; }
        .slot-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .slot-item { border: 1px solid #333; padding: 10px; background: #050505; text-align: center; border-radius: 5px; min-height: 100px; display: flex; flex-direction: column; justify-content: space-between; }
        .term-container { background: var(--term-bg); border: 1px solid #333; height: 250px; overflow-y: auto; padding: 10px; font-size: 10px; color: #ccc; border-radius: 5px; display: flex; flex-direction: column-reverse; }
        .log-line { margin-bottom: 4px; border-bottom: 1px solid #111; padding-bottom: 2px; }
        #loginOverlay { display: flex; position: fixed; inset: 0; background: #000; z-index: 10000; justify-content: center; align-items: center; flex-direction: column; }
        .login-box { width: 300px; padding: 30px; border: 1px solid var(--gold); border-radius: 10px; background: #111; text-align: center; box-shadow: 0 0 30px rgba(255, 215, 0, 0.15); }
    </style>
</head>
<body>
    <div id="loginOverlay">
        <div class="login-box">
            <h2 style="font-family:'Teko'; color:var(--gold); margin-top:0; font-size:36px;">GOD MODE</h2>
            <div style="margin-bottom:20px;">
                <input type="password" id="loginPin" placeholder="PIN SUPER ADMIN" style="text-align:center; font-size:24px; letter-spacing:5px; border-color:var(--gold);">
            </div>
            <button onclick="attemptLogin()" class="btn-gold" style="width:100%; font-size:20px;">BUKA AKSES</button>
        </div>
    </div>
    <div style="display:flex; justify-content:space-between; margin-bottom:15px; align-items:center;">
        <div><span style="font-family:'Teko'; font-size:28px; color:var(--gold);">SUPER ADMIN <span style="color:#fff; font-size:12px;">(GOD MODE)</span></span></div>
        <div style="display:flex; gap:5px;"><button onclick="window.location.href='index.html'" class="btn-blue">DEPAN</button><button onclick="logout()" class="btn-red">KELUAR</button></div>
    </div>
    <div class="box">
        <h3>1. LIVE EDIT (GANTI PLAT/NAMA)</h3>
        <div class="slot-grid"><div id="slot1" class="slot-item">...</div><div id="slot2" class="slot-item">...</div><div id="slot3" class="slot-item">...</div></div>
        <div style="margin-top:15px; padding-top:10px; border-top:1px dashed #333;">
            <div style="color:#888; margin-bottom:5px;">ANTRIAN (Klik Edit untuk Ubah Typo):</div>
            <div id="queueList" style="max-height:200px; overflow-y:auto; border:1px solid #333; padding:5px; background:#050505;"></div>
        </div>
    </div>
    <div class="box" style="border-top: 3px solid var(--blue);">
        <h3 style="color:var(--blue);">2. SET JABATAN PENGURUS</h3>
        <div style="font-size:10px; color:#aaa; margin-bottom:10px;">Input Plat Nomor orangnya, pilih jabatan, klik Simpan. Otomatis update.</div>
        <div style="display:flex; gap:5px; margin-bottom:5px;">
            <input id="rolePlat" placeholder="PLAT NOMOR (Cth: B 1 ILHAM)" style="flex:2; text-transform:uppercase;">
            <select id="roleSelect" style="flex:2;">
                <option value="MEMBER">KELUARGA MLU</option>
                <option value="KETUM">KETUM</option>
                <option value="WAKETUM">WAKETUM</option>
                <option value="SEKRETARIS">SEKRETARIS</option>
                <option value="PEMBINA">PEMBINA</option>
                <option value="PENASEHAT">PENASEHAT</option>
                <option value="HUMAS">HUMAS</option>
                <option value="KORLAP">KORLAP</option>
            </select>
        </div>
        <button onclick="setJabatan()" class="btn-blue" style="width:100%;">SIMPAN & UPDATE BADGE</button>
    </div>
    <div class="box" style="border-top: 3px solid var(--red);">
        <h3 style="color:var(--red);">3. DANGER ZONE (RESET)</h3>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button onclick="if(confirm('Reset Nomor Antrian jadi 1? Slot charging tetap aman.')) resetDaily()" class="btn-gold">☀ RESET NOMOR HARIAN</button>
            <button onclick="if(confirm('BAHAYA: Hapus SEMUA data antrian & slot?')) resetTotal()" class="btn-red">⚠ WIPE TOTAL (0)</button>
        </div>
    </div>
    <div class="box">
        <h3>4. SYSTEM LOGS</h3>
        <div class="term-container" id="termLog"><div class="log-line">Waiting for logs...</div></div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, runTransaction, collection, addDoc, query, orderBy, limit, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyB666i9lYWIpxOdkwpoX9EvFvHLmHczeq8", authDomain: "fcgadingnew22.firebaseapp.com", projectId: "fcgadingnew22", storageBucket: "fcgadingnew22.firebasestorage.app", messagingSenderId: "537736846678", appId: "1:537736846678:web:53788d71a196423ac08af7" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const mainRef = doc(db, "antrian", "utama");
        const logRef = collection(db, "activityLog");
        let cachedData = null;
        window.attemptLogin = () => {
            if(document.getElementById('loginPin').value === "090815") { document.getElementById('loginOverlay').style.display = 'none'; addLog("SUPER_ADMIN", "LOGIN", "God Mode Accessed"); } else { alert("PIN SALAH!"); }
        };
        window.logout = () => window.location.href='index.html';
        onSnapshot(mainRef, (snap) => {
            if(!snap.exists()) return;
            const d = snap.data(); cachedData = d;
            (d.chargingSlots || [null,null,null]).forEach((s, i) => {
                const el = document.getElementById(`slot${i+1}`);
                if(s) { el.innerHTML = `<div style="color:var(--blue); font-size:16px; font-weight:bold;">${s.plat}</div><div style="font-size:12px;">${s.userName}</div><div style="margin-top:auto; width:100%;"><button onclick="editData('slot', ${i})" class="btn-gold btn-mini" style="width:100%;">EDIT DATA</button></div>`; el.style.border = "1px solid var(--blue)"; } 
                else { el.innerHTML = `<div style="color:#555; margin:auto;">KOSONG</div>`; el.style.border = "1px solid #333"; }
            });
            const qList = document.getElementById('queueList'); qList.innerHTML = '';
            (d.waitingQueue || []).forEach((q, i) => {
                const div = document.createElement('div');
                div.style.cssText = "display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #222; padding:5px;";
                div.innerHTML = `<span><span style="color:var(--gold)">#${q.qNo}</span> <b>${q.plat}</b> <span style="font-size:10px; color:#888;">${q.userName}</span></span><button onclick="editData('queue', '${q.plat}')" class="btn-gold btn-mini">EDIT</button>`;
                qList.appendChild(div);
            });
        });
        window.editData = (type, id) => {
            let oldP = "", oldN = "";
            if(type === 'slot') { if(!cachedData.chargingSlots[id]) return alert("Slot Kosong"); oldP = cachedData.chargingSlots[id].plat; oldN = cachedData.chargingSlots[id].userName; } 
            else { const q = cachedData.waitingQueue.find(x => x.plat === id); oldP = q.plat; oldN = q.userName; }
            const newP = prompt("GANTI PLAT:", oldP); if(!newP) return;
            const newN = prompt("GANTI NAMA:", oldN); if(!newN) return;
            runTransaction(db, async(t) => {
                const d = (await t.get(mainRef)).data();
                if(type === 'slot') { d.chargingSlots[id].plat = newP.toUpperCase(); d.chargingSlots[id].userName = newN.toUpperCase(); } 
                else { const idx = d.waitingQueue.findIndex(x => x.plat === id); if(idx > -1) { d.waitingQueue[idx].plat = newP.toUpperCase(); d.waitingQueue[idx].userName = newN.toUpperCase(); } }
                t.update(mainRef, { chargingSlots: d.chargingSlots, waitingQueue: d.waitingQueue });
                addLog("SUPER_ADMIN", "EDIT_DATA", `${oldP} -> ${newP}`);
            });
        };
        window.setJabatan = () => {
            const p = document.getElementById('rolePlat').value.toUpperCase(); const r = document.getElementById('roleSelect').value; if(!p) return alert("Isi Plat!"); const cleanP = p.replace(/[^A-Z0-9]/g, '');
            setDoc(doc(db, "members", cleanP), { plat: p, role: r, verified: true }, {merge:true});
            runTransaction(db, async(t) => {
                const d = (await t.get(mainRef)).data(); let updated = false;
                const newQ = d.waitingQueue.map(q => { if(q.plat.replace(/[^A-Z0-9]/g,'') === cleanP) { updated=true; return {...q, role: r, isMember: true}; } return q; });
                const newS = d.chargingSlots.map(s => { if(s && s.plat.replace(/[^A-Z0-9]/g,'') === cleanP) { updated=true; return {...s, role: r, isMember: true}; } return s; });
                if(updated) t.update(mainRef, { waitingQueue: newQ, chargingSlots: newS });
            }).then(() => { alert(`BERHASIL! ${p} sekarang ${r}`); addLog("SUPER_ADMIN", "SET_ROLE", `Set ${p} as ${r}`); document.getElementById('rolePlat').value = ''; });
        };
        window.resetDaily = () => { runTransaction(db, async(t) => { t.update(mainRef, { waitingQueue: [], recycledNumbers: [], lastTicket: 0 }); addLog("SUPER_ADMIN", "RESET_DAILY", "Reset Queue Numbers"); }); };
        window.resetTotal = () => { setDoc(mainRef, { chargingSlots:[null,null,null], waitingQueue:[], recycledNumbers:[], lastTicket:0 }).then(() => addLog("SUPER_ADMIN", "RESET_TOTAL", "Wiped Everything")); };
        onSnapshot(query(logRef, orderBy("timestamp", "desc"), limit(50)), (snap) => {
            let h = ''; snap.forEach(d => { const x = d.data(); const time = x.timestamp ? x.timestamp.toDate().toLocaleTimeString() : '-'; h += `<div class="log-line"><span style="color:#666">[${time}]</span> <b style="color:var(--gold)">${x.actor}</b>: ${x.action} - ${x.details}</div>`; });
            document.getElementById('termLog').innerHTML = h;
        });
        function addLog(actor, act, det) { addDoc(logRef, { action: act, details: det, actor: actor, timestamp: new Date() }); }
    </script>
</body>
</html>
